<html>

<head>

<script>

    var rightSlotCode = '/19968336/header-bid-tag-0';
    var rightSlotSizes = [[300, 250], [300, 600]];

    var topSlotCode = '/19968336/header-bid-tag1';
    var topSlotSizes = [[728, 90], [970, 90]];


    
	var pbjs = pbjs || {},
	PREBID_TIMEOUT = 2000;


	// code must be unique. It's an ID you used to identify with your adserver tag. 
	// sizes are required. 
	pbjs.adUnits = [
        {
            code: rightSlotCode,
            sizes: rightSlotSizes,
            bids: [{
                        bidder: 'appnexus',
                        params: {
                           placementId: '4799418'
                        }
                    },
                    {
                        bidder: 'rubicon',
                        params: {
                           rp_account : '9707',
                           rp_site: '17955',
                           rp_zonesize : '50983-15',
                           rp_tracking : 'affiliate-1701207318',
                           rp_inventory : '{ deals : "mobv3_excl,atf,demo1849,csm1834,znexcl1,exunisite,exmars,extargt,ldacomp,ent19116,rn14858,ukent,g03070,qc12170,qc2690,qc2695,qc1988,asov1,qc12172,qc12169,qc27434,rn24858,ent29116,lngen,cntq,cntauto,anthea,smg_blklist,amnetctr,ntflxblk,amtblk,zentend,nortb,deschoeff,js,excltop," }',
                           rp_floor : '0.1'
                        }
                    },
                    {
                        bidder: 'openx',
                        params: {
                            unit: 537245128,
                            pageURL : 'http://drudgereport.com',
                            refererURL : 'http://drudgereport.com',
                            jstag_url : 'http://ox-d.intermarkets.net/w/1.0/jstag'
                        }
                    },
                    {
                        bidder: 'pubmatic',
                        params: {
                            publisherId: 39741,
                            adSlot: '39620189@300x250'
                        }
                    }

                    ]
        },
        {
            code: topSlotCode,
            sizes: topSlotSizes,
            bids: [{
                        bidder: 'appnexus',
                        params: {
                            placementId : '5215561'
                            //memberId : '1234',
                            //invCode : '7454'
                        }
                    }]



        }
    ];

  
    //   Optional key value settings targeting by bidder 
    
     pbjs.bidderSettings = 
            {
                standard: {
                    adserverTargeting: [{
                        key: "hb_bidder",
                        val: function(bidResponse) {
                            return bidResponse.bidderCode;
                        }
                    }, {
                        key: "hb_adid",
                        val: function(bidResponse) {
                            return bidResponse.adId;
                        }
                    }, {
                        key: "hb_pb",
                        val: function(bidResponse) {
                            return bidResponse.pbMg;
                        }
                    }, {
                        key: "hb_size",
                        val: function(bidResponse) {
                            return bidResponse.getSize();

                        }
                    }]
                }
        };

    //  Optional callback handler function that will get called when all bids are available for timed out
    pbjs.registerBidCallbackHandler = function(){
        initAdserver();
    };

    (function() {
        var prbEl = document.createElement("script"); prbEl.type = "text/javascript"
        //prbEl.src = ("https:" == document.location.protocol ? "https://" : "http://") + "s3.amazonaws.com/APN-test/prebid.js";
        prbEl.src = '../../dist/build/prebid.js';
        var csaTargetEl = document.getElementsByTagName("head")[0];
        csaTargetEl.insertBefore(prbEl, csaTargetEl.firstChild);
    })();

    var googletag = googletag || {};
    googletag.cmd = googletag.cmd || [];

    // Load the Prebid Javascript Library Async
    function initAdserver() {
        //load GPT library here
        (function() {
            var gads = document.createElement('script');
            gads.async = true;
            gads.type = 'text/javascript';
            var useSSL = 'https:' == document.location.protocol;
            gads.src = (useSSL ? 'https:' : 'http:') +
            '//www.googletagservices.com/tag/js/gpt.js';
            var node = document.getElementsByTagName('script')[0];
            node.parentNode.insertBefore(gads, node);
        })();
        pbjs.initAdserverSet = true;

             // pass a code to get one particular ad unit
             console.log('Dumping all bid objects to console:');
            console.log(pbjs.getBidResponses(rightSlotCode));
        
    };
    //force load the ads if no response from prebid.js
    setTimeout(initAdserver, PREBID_TIMEOUT);
</script>


<script>
    googletag.cmd.push(function() {

        var rightSlot = googletag.defineSlot(rightSlotCode, rightSlotSizes, 'div-gpt-ad-1438287399331-0').addService(googletag.pubads());

        //create a mock slot object to verifying we are writing correctly
        // rightSlot = {};
        // rightSlot.setTargeting = function(key, value){
        //     console.log('Writing key value pair for :' + key + ':' + value);
        // }

      

        //rightSlot.setTargeting("apn_key", '300x250p1.00');
        //rightSlot.setTargeting("apn_adid", abcall);

        var topSlot = googletag.defineSlot(topSlotCode, topSlotSizes, 'div-gpt-ad-1438287399331-1').addService(googletag.pubads());
        if (pbjs.libLoaded) {
           //pbjs.setTargetingForGPTAsync(topSlotCode, topSlot);
        }

        if (pbjs.libLoaded) {
            pbjs.setTargetingForGPTAsync();
        }

        // Set key value pairs from prebid response into slot  
        if (pbjs.libLoaded) {
            console.log('Are all bids available? : ' + pbjs.allBidsAvailable()); // return bool
            console.log('Dumping all bid objects to console:');
            console.log(pbjs.getBidResponses()); // pass a code to get one particular ad unit
            console.log('Targeting params for topSlot ' + pbjs.getAdserverTargetingParamsForAdUnit (topSlotCode)); 
            console.log('Targeting params for rightSlot ' + pbjs.getAdserverTargetingParamsForAdUnit(rightSlotCode));
        }

        googletag.pubads().enableSingleRequest();
        googletag.enableServices();   

        
    });


    </script>
</head>


<body>

    <h2>Prebid.js Test3</h2>

    <!-- /19968336/pbjs-right1-300x250-300x600 -->
    <div id='div-gpt-ad-1438287399331-0'>
        <script type='text/javascript'>
            googletag.cmd.push(function() { googletag.display('div-gpt-ad-1438287399331-0'); });
        </script>
    </div>



    <!-- /19968336/PBJS-top-728x90-970x90 -->
    <div id='div-gpt-ad-1438287399331-1'>
        <script type='text/javascript'>
            googletag.cmd.push(function() { googletag.display('div-gpt-ad-1438287399331-1'); });
        </script>
    </div>




</body>

</html>
